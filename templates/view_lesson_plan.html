{% extends "base.html" %}

{% block title %}Plan: {{ plan.lesson_title }} - CUHK PE Planner{% endblock %}

{% block styles %}
<style>
    .success-message {
        background-color: #d4edda;
        border-left: 4px solid #28a745;
        padding: 1rem;
        margin-bottom: 2rem;
    }
    @media print {
        .no-print {
            display: none;
        }
        .page, .page-break { break-after: page; }
        body {
            font-size: 12pt;
            color: black;
        }
        .card {
            border: 1px solid black;
        }
    }
    .print-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 100;
    }
    .lesson-section {
        margin-bottom: 2rem;
    }
    .chinese-section {
        font-family: "Microsoft JhengHei", "PMingLiU", sans-serif;
    }
    .lesson-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1rem;
    }
    .lesson-table th,
    .lesson-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
        vertical-align: top;
    }
    .lesson-table th {
        background-color: #f8f9fa;
        font-weight: 600;
    }
    .section-title {
        padding-bottom: 0.5rem;
        margin: 2rem 0 1rem 0;
    }
</style>
{% endblock %}

{% block content %}
<!-- Success Message with Feedback Prompt -->
<div class="success-message no-print">
    <h5>Lesson plan created successfully!</h5>
    <p>How was your experience?
       <a href="#" data-bs-toggle="modal" data-bs-target="#feedbackModal" class="text-decoration-none">Tell us what you think</a> 
       to help us improve our platform!
    </p>
</div>

<!-- ENGLISH LESSON PLAN -->
<div class="lesson-section">
    <h1 style="margin-top:0pt; margin-bottom:0pt; text-align:center; line-height:18pt;">
        <strong><u><span>Lesson Plan</span></u></strong>
    </h1>
    
    <!-- Basic Information -->
    <p><strong>Plan ID:</strong> {{ plan.id }}</p>
    <p><strong>Student-teacher's name:</strong> {{ plan.teacher_name }} (PESH Year {{ plan.pesh_year }})</p>
    <p><strong>Date:</strong> {{ plan.date }} <strong>Time:</strong> {{ plan.class_duration }} mins ({{ plan.start_time }} to {{ plan.end_time }})</p>
    <p><strong>School Name:</strong> {{ plan.school_name }}</p>
    <p><strong>Year:</strong> {{ plan.year }} <strong>Class: </strong>{{ plan.class_id }} <strong>Level: </strong>{{ plan.class_level }} <strong>Class Size: </strong>{{ plan.class_size }} (Boys: {{ plan.boys }} Girls: {{ plan.girls }})</p>
    <p><strong>Unit Topic: </strong>{{ plan.topic }} (Day {{ plan.day_of_unit }} of {{ plan.unit_duration }} days of the Unit)</p>
    <p><strong>Main Theme of this Lesson:</strong> {{ plan.lesson_theme }}</p>
    <p><strong>Students' Ability Level:</strong> {{ plan.ability_level }}% proficiency</p>
    <p></p>

    <!-- Objectives Table -->
    <h4 class="section-title">1.) Lesson Objectives:</h4>
    <table class="lesson-table">
        <tbody>
            <tr>
                <td>
                    <p><strong>i) Psychomotor performance objectives</strong></p>
                    <p>{{ plan.psychomotor_objs }}</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p><strong>ii) Cognitive performance objectives</strong></p>
                    <p>{{ plan.cognitive_objs }}</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p><strong>iii) Affective objectives</strong></p>
                    <p>{{ plan.affective_objs }}</p>
                </td>
            </tr>
        </tbody>
    </table>

    <p><strong>Teaching Venue/Facility:</strong> {{ plan.venue }}</p>
    <p><strong>Equipment:</strong> {{ plan.equipment }}</p>
    <p><strong>Safety Concerns:</strong> {{ plan.safety_concerns }}</p>
</div>

<div class="page-break"></div>

<!-- LESSON PLANNING TABLE - ENGLISH -->
<div class="lesson-section">
    <h4 class="section-title">2.) Lesson Planning:</h4>
    
    <table class="lesson-table">
        <thead>
            <tr>
                <th style="width: 8%;">Time</th>
                <th style="width: 25%;">Teaching Content/Activity</th>
                <th style="width: 23%;">Teaching Cues/Objectives</th>
                <th style="width: 25%;">Class Organization/Management/Teacher's Positions</th>
                <th style="width: 19%;">Equipment</th>
            </tr>
        </thead>
        <tbody>
            <!-- Introductory Activities -->
            <tr>
                <td style="text-align: center;"><strong>{{ plan.intro_time }}</strong> mins</td>
                <td><strong>Introductory Activities</strong></td>
                <td style="text-align: center;">{{ plan.intro_cues }}</td>
                <td style="text-align: center;">
                    {% if plan.intro_diagram %}
                        <img src="{{ plan.intro_diagram }}" style="max-width:100%; max-height:100px;" alt="Introductory Activities Diagram">
                    {% else %}
                        <em>(No diagram uploaded)</em>
                    {% endif %}
                </td>
                <td style="text-align: center;">{{ plan.intro_equipment }}</td>
            </tr>
            
            <!-- Skill Development -->
            <tr>
                <td style="text-align: center;"><strong>{{ plan.sd_time }}</strong> mins</td>
                <td><strong>Skill Development</strong></td>
                <td style="text-align: center;">{{ plan.sd_cues }}</td>
                <td style="text-align: center;">
                    {% if plan.sd_diagram %}
                        <img src="{{ plan.sd_diagram }}" style="max-width:100%; max-height:100px;" alt="Skill Development Diagram">
                    {% else %}
                        <em>(No diagram uploaded)</em>
                    {% endif %}
                </td>
                <td style="text-align: center;">{{ plan.sd_equipment }}</td>
            </tr>
            
            <!-- Application -->
            <tr>
                <td style="text-align: center;"><strong>{{ plan.appli_time }}</strong> mins</td>
                <td><strong>Application</strong></td>
                <td style="text-align: center;">{{ plan.appli_cues }}</td>
                <td style="text-align: center;">
                    {% if plan.appli_diagram %}
                        <img src="{{ plan.appli_diagram }}" style="max-width:100%; max-height:100px;" alt="Application Diagram">
                    {% else %}
                        <em>(No diagram uploaded)</em>
                    {% endif %}
                </td>
                <td style="text-align: center;">{{ plan.appli_equipment }}</td>
            </tr>
            
            <!-- Concluding Activities -->
            <tr>
                <td style="text-align: center;"><strong>{{ plan.ca_time }}</strong> mins</td>
                <td><strong>Concluding Activities</strong></td>
                <td style="text-align: center;">{{ plan.ca_cues }}</td>
                <td style="text-align: center;">
                    {% if plan.ca_diagram %}
                        <img src="{{ plan.ca_diagram }}" style="max-width:100%; max-height:100px;" alt="Concluding Activities Diagram">
                    {% else %}
                        <em>(No diagram uploaded)</em>
                    {% endif %}
                </td>
                <td style="text-align: center;">{{ plan.ca_equipment }}</td>
            </tr>
        </tbody>
    </table>

    <!-- Follow-up and Reflection -->
    <h4 class="section-title">3.) Follow-up Actions:</h4>
    <p>{{ plan.followup_actions }}</p>

    <h4 class="section-title">4.) Self-reflection:</h4>
    <p>{{ plan.self_reflection }}</p>
</div>

<div class="page-break"></div>

<!-- CHINESE LESSON PLAN -->
<div class="lesson-section chinese-section">
    <h1 style="text-align: center; line-height: 18pt;">
        <strong><u>æ•™æ¡ˆ</u></strong>
    </h1>
    
    <!-- Chinese Header Information -->
    <p><strong>å¯¦ç¿’æ•™å¸«å§“å:</strong> {{ plan.teacher_name_zh }} (PESH Year {{ plan.pesh_year }})</p>
    <p><strong>æ—¥æœŸ:</strong> {{ plan.date }} <strong>ä¸Šèª²æ™‚é–“:</strong> {{ plan.class_duration }}åˆ†é˜ ({{ plan.start_time }} è‡³ {{ plan.end_time }})</p>
    <p><strong>å­¸æ ¡åç¨±:</strong> {{ plan.school_name_zh }}</p>
    <p><strong>ç­ç´š:</strong> {{ plan.year }} <strong>ç­åˆ¥: </strong>{{ plan.class_id_zh }} <strong>ç´šåˆ¥: </strong>
        {% if plan.class_level_zh == 'Primary' %}å°å­¸{% else %}ä¸­å­¸{% endif %} 
        <strong>å­¸ç”Ÿäººæ•¸: </strong>{{ plan.class_size }} (ç”·ç”Ÿ: {{ plan.boys }} å¥³ç”Ÿ: {{ plan.girls }} )
    </p>
    <p><strong>å–®å…ƒä¸»é¡Œ: </strong>{{ plan.topic_zh }} (æœ¬å–®å…ƒç¬¬ {{ plan.day_of_unit }}/{{ plan.unit_duration }} èª²æ™‚)</p>
    <p><strong>æœ¬æ•™ç¯€çš„æ•™å­¸ä¸»é¡Œ:</strong> {{ plan.lesson_theme_zh }}</p>
    <p><strong>å­¸ç”Ÿèƒ½åŠ›:</strong> {{ plan.ability_level }}% ç†Ÿç·´åº¦</p>
    <p></p>

    <!-- Chinese Objectives Table -->
    <h4 class="section-title">1.) æ•™å­¸ç›®æ¨™:</h4>
    <table class="lesson-table">
        <tbody>
            <tr>
                <td>
                    <p><strong>i) æŠ€èƒ½è¡¨ç¾ç›®æ¨™</strong></p>
                    <p>{{ plan.psychomotor_objs_zh }}</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p><strong>ii) èªçŸ¥è¡¨ç¾ç›®æ¨™</strong></p>
                    <p>{{ plan.cognitive_objs_zh }}</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p><strong>iii) æƒ…æ„è¡¨ç¾ç›®æ¨™</strong></p>
                    <p>{{ plan.affective_objs_zh }}</p>
                </td>
            </tr>
        </tbody>
    </table>

    <p><strong>æ•™å­¸å ´åœ°/è¨­æ–½:</strong> {{ plan.venue_zh }}</p>
    <p><strong>å™¨æ:</strong> {{ plan.equipment_zh }}</p>
    <p><strong>å®‰å…¨è€ƒæ…®:</strong> {{ plan.safety_concerns_zh }}</p>
</div>

<div class="page-break"></div>

<!-- CHINESE LESSON PLANNING TABLE -->
<div class="lesson-section chinese-section">
    <h4 class="section-title">2.) æ•™æ¡ˆè¦åŠƒ:</h4>
    
    <table class="lesson-table">
        <thead>
            <tr>
                <th style="width: 8%;">æ™‚é–“</th>
                <th style="width: 25%;">æ•™å­¸å…§å®¹/æ´»å‹•</th>
                <th style="width: 23%;">æ•™å­¸è¦é»/ç›®æ¨™</th>
                <th style="width: 25%;">èª²å ‚çµ„ç¹”/ç®¡ç†/æ•™å¸«ä½ç½®</th>
                <th style="width: 19%;">æ‰€éœ€å™¨æ/ç”¨å…·</th>
            </tr>
        </thead>
        <tbody>
            <!-- å¼•å…¥æ´»å‹• -->
            <tr>
                <td style="text-align: center;"><strong>{{ plan.intro_time }}</strong> åˆ†é˜</td>
                <td><strong>å¼•å…¥æ´»å‹•</strong></td>
                <td style="text-align: center;">{{ plan.intro_cues_zh }}</td>
                <td style="text-align: center;">
                    {% if plan.intro_diagram %}
                        <img src="{{ plan.intro_diagram }}" style="max-width:100%; max-height:100px;" alt="å¼•å…¥æ´»å‹•åœ–è¡¨">
                    {% else %}
                        <em>(æ²’æœ‰ä¸Šå‚³åœ–è¡¨)</em>
                    {% endif %}
                </td>
                <td style="text-align: center;">{{ plan.intro_equipment_zh }}</td>
            </tr>
            
            <!-- æŠ€èƒ½ç™¼å±• -->
            <tr>
                <td style="text-align: center;"><strong>{{ plan.sd_time }}</strong> åˆ†é˜</td>
                <td><strong>æŠ€èƒ½ç™¼å±•</strong></td>
                <td style="text-align: center;">{{ plan.sd_cues_zh }}</td>
                <td style="text-align: center;">
                    {% if plan.sd_diagram %}
                        <img src="{{ plan.sd_diagram }}" style="max-width:100%; max-height:100px;" alt="æŠ€èƒ½ç™¼å±•åœ–è¡¨">
                    {% else %}
                        <em>(æ²’æœ‰ä¸Šå‚³åœ–è¡¨)</em>
                    {% endif %}
                </td>
                <td style="text-align: center;">{{ plan.sd_equipment_zh }}</td>
            </tr>
            
            <!-- éå›º/æ‡‰ç”¨æ´»å‹• -->
            <tr>
                <td style="text-align: center;"><strong>{{ plan.appli_time }}</strong> åˆ†é˜</td>
                <td><strong>éå›º/æ‡‰ç”¨æ´»å‹•</strong></td>
                <td style="text-align: center;">{{ plan.appli_cues_zh }}</td>
                <td style="text-align: center;">
                    {% if plan.appli_diagram %}
                        <img src="{{ plan.appli_diagram }}" style="max-width:100%; max-height:100px;" alt="æ‡‰ç”¨æ´»å‹•åœ–è¡¨">
                    {% else %}
                        <em>(æ²’æœ‰ä¸Šå‚³åœ–è¡¨)</em>
                    {% endif %}
                </td>
                <td style="text-align: center;">{{ plan.appli_equipment_zh }}</td>
            </tr>
            
            <!-- æ•´ç†æ´»å‹• -->
            <tr>
                <td style="text-align: center;"><strong>{{ plan.ca_time }}</strong> åˆ†é˜</td>
                <td><strong>æ•´ç†æ´»å‹•</strong></td>
                <td style="text-align: center;">{{ plan.ca_cues_zh }}</td>
                <td style="text-align: center;">
                    {% if plan.ca_diagram %}
                        <img src="{{ plan.ca_diagram }}" style="max-width:100%; max-height:100px;" alt="æ•´ç†æ´»å‹•åœ–è¡¨">
                    {% else %}
                        <em>(æ²’æœ‰ä¸Šå‚³åœ–è¡¨)</em>
                    {% endif %}
                </td>
                <td style="text-align: center;">{{ plan.ca_equipment_zh }}</td>
            </tr>
        </tbody>
    </table>

    <!-- Chinese Follow-up and Reflection -->
    <h4 class="section-title">3.) è·Ÿé€²äº‹é …:</h4>
    <p>{{ plan.followup_actions_zh }}</p>

    <h4 class="section-title">4.) è‡ªæˆ‘åæ€:</h4>
    <p>{{ plan.self_reflection_zh }}</p>
</div>

<!-- Action Buttons -->
<div class="text-center mt-4 no-print">
    <a href="{{ url_for('create_lesson_form') }}" class="btn btn-primary me-2">Create Another Lesson Plan</a>
    <a href="{{ url_for('create_unit_form') }}" class="btn btn-primary me-2">Create Unit Plan</a>
    <button onclick="window.print()" class="btn btn-outline-primary me-2">Print Plan</button>
    <button class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#feedbackModal">
        Feedback
    </button>
</div>

<button onclick="window.print()" class="btn btn-primary print-btn no-print">
    ğŸ“„ Print
</button>
{% endblock %}
