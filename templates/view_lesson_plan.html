{% extends "base.html" %}

{% block title %}Plan: {{ plan.lesson_title }} - CUHK PE Planner{% endblock %}

{% block styles %}
<style>
    .success-message {
        background-color: #d4edda;
        border-left: 4px solid #28a745;
        padding: 1rem;
        margin-bottom: 2rem;
    }
    @media print {
        .no-print {
            display: none;
        }
        .page, .page-break { break-after: page; }
        body {
            font-size: 12pt;
            color: black;
        }
        .card {
            border: 1px solid black;
        }
    }
    .print-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 100;
    }
    .lesson-section {
        margin-bottom: 2rem;
    }
    .chinese-section {
        font-family: "Microsoft JhengHei", "PMingLiU", sans-serif;
    }
    .lesson-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1rem;
    }
    .lesson-table th,
    .lesson-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
        vertical-align: top;
    }
    .lesson-table th {
        background-color: #f8f9fa;
        font-weight: 600;
    }
    .section-title {
        padding-bottom: 0.5rem;
        margin: 2rem 0 1rem 0;
    }
    .inline-elements {
        margin-right: 1rem;
        display: inline-block;
    }
    .inline-elements:last-child {
        margin-right: 0;
    }
    .ability-bar {
        position: relative;
        height: 12px;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        background: #f8f9fa;
        margin-bottom: 0.35rem;
    }
    .ability-divider {
        position: absolute;
        top: -2px;
        bottom: -2px;
        width: 2px;
        background: #6c757d;
    }
    .ability-bar-wrapper {
        margin-bottom: 0.5rem;
    }
    .ability-labels-absolute {
        position: relative;
        height: 1.5rem;
        margin-top: 0.25rem;
    }
    .ability-labels-absolute span {
        position: absolute;
        transform: translateX(-50%);
        text-align: center;
        white-space: nowrap;
        font-size: 0.75rem;
    }
    @media (max-width: 576px) {
        .ability-labels-absolute {
            height: 3rem;
        }
        .ability-labels-absolute span {
            white-space: normal;
            font-size: 0.7rem;
            line-height: 1.2;
        }
        .lesson-table {
            font-size: 0.85rem;
        }
        .lesson-table th,
        .lesson-table td {
            padding: 6px 4px;
        }
        .inline-elements {
            display: block;
            margin-right: 0;
            margin-bottom: 0.25rem;
        }
        .section-title {
            font-size: 1.1rem;
            margin: 1.5rem 0 0.75rem 0;
        }
        .lesson-section {
            margin-bottom: 1.5rem;
        }
    }
    @media (max-width: 768px) {
        .lesson-table th,
        .lesson-table td {
            padding: 6px;
            font-size: 0.9rem;
        }
        .inline-elements {
            margin-right: 0.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
{% set lang = plan.template_language %}
{% set show_en = (not lang) or lang == 'english' %}
{% set show_zh = (not lang) or lang == 'chinese' %}

<!-- Success Message with Feedback Prompt -->
<div class="success-message no-print">
    <h5>Lesson plan created successfully!</h5>
    <p>How was your experience?
       <a href="#" data-bs-toggle="modal" data-bs-target="#feedbackModal" class="text-decoration-none">Tell us what you think</a> 
       to help us improve our platform!
    </p>
</div>

{% if show_en %}
<!-- ENGLISH LESSON PLAN -->
<div class="lesson-section">
    <h1 style="margin-top:0pt; margin-bottom:0pt; text-align:center; line-height:18pt;">
        <strong><u><span>Lesson Plan</span></u></strong>
    </h1>
    
    <!-- Basic Information -->
    <p><strong>Lesson Plan ID:</strong> {{ plan.id }}</p>
    <p><span class="inline-elements"><strong>Student-teacher's name:</strong> {{ plan.teacher_name }}</span><span class="inline-elements">(PESH Year {{ plan.pesh_year }})</span></p>
    <p>
        <span class="inline-elements"><strong>Date:</strong> {{ plan.date }}</span>
        <span class="inline-elements"><strong>Time:</strong> {{ plan.class_duration }} mins ({{ plan.start_time }} to {{ plan.end_time }})</span>
    </p>
    <p><strong>School Name:</strong> {{ plan.school_name }}</p>
    <p>
        <span class="inline-elements"><strong>Year:</strong> {{ plan.year }}</span>
        <span class="inline-elements"><strong>Class:</strong> {{ plan.class_id }}</span>
        <span class="inline-elements"><strong>Level:</strong> {{ plan.class_level }}</span>
        <span class="inline-elements"><strong>Class Size:</strong> {{ plan.class_size }}</span>
        <span class="inline-elements"><strong>Boys:</strong> {{ plan.boys }}</span>
        <span class="inline-elements"><strong>Girls:</strong> {{ plan.girls }}</span>
    </p>
    <p><strong>Unit Topic: </strong>{{ plan.topic }} <span class="inline-elements">(Day {{ plan.day_of_unit }} of {{ plan.unit_duration }} days)</span></p>
    <p><strong>Main Theme of this Lesson:</strong> {{ plan.lesson_theme }}</p>
    {% set beg = (plan.beginner_percent or 0) | int %}
    {% set inter = (plan.intermediate_percent or 0) | int %}
    {% set adv = (plan.advance_percent or 0) | int %}
    {% set total = beg + inter + adv %}
    <p><strong>Students' Overall Ability Level:</strong> {{ plan.ability_level }}% proficiency</p>
    <ul class="list-unstyled ms-3 mb-2">
        <li>Beginner: {{ beg }}%</li>
        <li>Intermediate: {{ inter }}%</li>
        <li>Advance: {{ adv }}%</li>
    </ul>
    <div class="ability-bar-wrapper" style="position: relative;">
        <div class="ability-bar" aria-hidden="true">
            {% if total > 0 %}
                <div class="ability-divider" style="left: {{ beg }}%;"></div>
                <div class="ability-divider" style="left: {{ beg + inter }}%;"></div>
            {% endif %}
        </div>
        {% if total > 0 %}
            {% set beg_pos = (beg / 2) %}
            {% set inter_pos = beg + (inter / 2) %}
            {% set adv_pos = beg + inter + (adv / 2) %}
            <div class="ability-labels-absolute small text-muted">
                <span style="left: {{ beg_pos }}%;">Beginner {{ beg }}%</span>
                <span style="left: {{ inter_pos }}%;">Intermediate {{ inter }}%</span>
                <span style="left: {{ adv_pos }}%;">Advance {{ adv }}%</span>
            </div>
        {% endif %}
    </div>

    <!-- Objectives Table -->
    <h4 class="section-title">1) Lesson Objectives:</h4>
    <p class="mb-2">Students will be able to:</p>
    <table class="lesson-table">
        <tbody>
            <tr>
                <td>
                    <p><strong>i) Psychomotor performance objectives</strong></p>
                    <p>{{ plan.psychomotor_objs }}</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p><strong>ii) Cognitive performance objectives</strong></p>
                    <p>{{ plan.cognitive_objs }}</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p><strong>iii) Affective objectives</strong></p>
                    <p>{{ plan.affective_objs }}</p>
                </td>
            </tr>
        </tbody>
    </table>

    <p><strong>Teaching Venue/Facility:</strong> {{ plan.venue }}</p>
    <p><strong>Equipment:</strong> {{ plan.equipment }}</p>
    <p><strong>Safety Concerns:</strong> {{ plan.safety_concerns }}</p>
</div>

<div class="page-break"></div>

<!-- LESSON PLANNING TABLE - ENGLISH -->
<div class="lesson-section">
    <h4 class="section-title">2) Lesson Planning:</h4>
    
    <table class="lesson-table">
        <thead>
            <tr>
                <th style="width: 8%;">Time (mins)</th>
                <th style="width: 25%;">Teaching content/ Activity</th>
                <th style="width: 23%;">Teaching Cues/Objectives</th>
                <th style="width: 25%;">Class Organization/Management/Teacher's Positions</th>
                <th style="width: 19%;">Equipment</th>
            </tr>
        </thead>
        <tbody>
            <!-- Introductory Activities -->
            {% if plan.intro_activities %}
                {% for activity in plan.intro_activities %}
                <tr>
                    <td style="text-align: center;"><strong>{{ activity.time }}</strong></td>
                    <td>{% if loop.first %}<strong>Introductory Activities</strong><br>{% endif %}{{ activity.content or '' }}</td>
                    <td style="text-align: center;">{{ activity.cues }}</td>
                    <td style="text-align: center;">
                        {% if activity.diagram %}
                            <img src="{{ activity.diagram }}" style="max-width:100%; max-height:100px;" alt="Diagram">
                        {% else %}
                            <em>(No diagram uploaded)</em>
                        {% endif %}
                    </td>
                    <td style="text-align: center;">{{ activity.equipment }}</td>
                </tr>
                {% endfor %}
            {% else %}
            <tr>
                <td style="text-align: center;"><strong>{{ plan.intro_time }}</strong></td>
                <td><strong>Introductory Activities</strong></td>
                <td style="text-align: center;">{{ plan.intro_cues }}</td>
                <td style="text-align: center;">
                    {% if plan.intro_diagram %}
                        <img src="{{ plan.intro_diagram }}" style="max-width:100%; max-height:100px;" alt="Introductory Activities Diagram">
                    {% else %}
                        <em>(No diagram uploaded)</em>
                    {% endif %}
                </td>
                <td style="text-align: center;">{{ plan.intro_equipment }}</td>
            </tr>
            {% endif %}
            
            <!-- Skill Development -->
            {% if plan.sd_activities %}
                {% for activity in plan.sd_activities %}
                <tr>
                    <td style="text-align: center;"><strong>{{ activity.time }}</strong></td>
                    <td>{% if loop.first %}<strong>Skill Development</strong><br>{% endif %}{{ activity.content or '' }}</td>
                    <td style="text-align: center;">{{ activity.cues }}</td>
                    <td style="text-align: center;">
                        {% if activity.diagram %}
                            <img src="{{ activity.diagram }}" style="max-width:100%; max-height:100px;" alt="Diagram">
                        {% else %}
                            <em>(No diagram uploaded)</em>
                        {% endif %}
                    </td>
                    <td style="text-align: center;">{{ activity.equipment }}</td>
                </tr>
                {% endfor %}
            {% else %}
            <tr>
                <td style="text-align: center;"><strong>{{ plan.sd_time }}</strong></td>
                <td><strong>Skill Development</strong></td>
                <td style="text-align: center;">{{ plan.sd_cues }}</td>
                <td style="text-align: center;">
                    {% if plan.sd_diagram %}
                        <img src="{{ plan.sd_diagram }}" style="max-width:100%; max-height:100px;" alt="Skill Development Diagram">
                    {% else %}
                        <em>(No diagram uploaded)</em>
                    {% endif %}
                </td>
                <td style="text-align: center;">{{ plan.sd_equipment }}</td>
            </tr>
            {% endif %}
            
            <!-- Application -->
            {% if plan.appli_activities %}
                {% for activity in plan.appli_activities %}
                <tr>
                    <td style="text-align: center;"><strong>{{ activity.time }}</strong></td>
                    <td>{% if loop.first %}<strong>Application</strong><br>{% endif %}{{ activity.content or '' }}</td>
                    <td style="text-align: center;">{{ activity.cues }}</td>
                    <td style="text-align: center;">
                        {% if activity.diagram %}
                            <img src="{{ activity.diagram }}" style="max-width:100%; max-height:100px;" alt="Diagram">
                        {% else %}
                            <em>(No diagram uploaded)</em>
                        {% endif %}
                    </td>
                    <td style="text-align: center;">{{ activity.equipment }}</td>
                </tr>
                {% endfor %}
            {% else %}
            <tr>
                <td style="text-align: center;"><strong>{{ plan.appli_time }}</strong></td>
                <td><strong>Application</strong></td>
                <td style="text-align: center;">{{ plan.appli_cues }}</td>
                <td style="text-align: center;">
                    {% if plan.appli_diagram %}
                        <img src="{{ plan.appli_diagram }}" style="max-width:100%; max-height:100px;" alt="Application Diagram">
                    {% else %}
                        <em>(No diagram uploaded)</em>
                    {% endif %}
                </td>
                <td style="text-align: center;">{{ plan.appli_equipment }}</td>
            </tr>
            {% endif %}
            
            <!-- Concluding Activities -->
            {% if plan.ca_activities %}
                {% for activity in plan.ca_activities %}
                <tr>
                    <td style="text-align: center;"><strong>{{ activity.time }}</strong></td>
                    <td>{% if loop.first %}<strong>Concluding Activities</strong><br>{% endif %}{{ activity.content or '' }}</td>
                    <td style="text-align: center;">{{ activity.cues }}</td>
                    <td style="text-align: center;">
                        {% if activity.diagram %}
                            <img src="{{ activity.diagram }}" style="max-width:100%; max-height:100px;" alt="Diagram">
                        {% else %}
                            <em>(No diagram uploaded)</em>
                        {% endif %}
                    </td>
                    <td style="text-align: center;">{{ activity.equipment }}</td>
                </tr>
                {% endfor %}
            {% else %}
            <tr>
                <td style="text-align: center;"><strong>{{ plan.ca_time }}</strong></td>
                <td><strong>Concluding Activities</strong></td>
                <td style="text-align: center;">{{ plan.ca_cues }}</td>
                <td style="text-align: center;">
                    {% if plan.ca_diagram %}
                        <img src="{{ plan.ca_diagram }}" style="max-width:100%; max-height:100px;" alt="Concluding Activities Diagram">
                    {% else %}
                        <em>(No diagram uploaded)</em>
                    {% endif %}
                </td>
                <td style="text-align: center;">{{ plan.ca_equipment }}</td>
            </tr>
            {% endif %}
        </tbody>
    </table>

    <!-- Follow-up and Reflection -->
    <h4 class="section-title">3) After Lesson:</h4>
    <h5 class="fw-bold fs-6">Follow-up Actions:</h5>
    <p>{{ plan.followup_actions }}</p>

    <h5 class="fw-bold fs-6 mt-3">Self-reflection:</h5>
    <p>{{ plan.self_reflection }}</p>
</div>

{% if show_zh %}
<div class="page-break"></div>
{% endif %}
{% endif %}

<!-- CHINESE LESSON PLAN -->
{% if show_zh %}
<div class="lesson-section chinese-section">
    <h1 style="text-align: center; line-height: 18pt;">
        <strong><u>æ•™æ¡ˆ</u></strong>
    </h1>
    
    <!-- Chinese Header Information -->
    <p><span class="inline-elements"><strong>å¯¦ç¿’æ•™å¸«å§“å:</strong> {{ plan.teacher_name_zh }}</span><span class="inline-elements">(PESH Year {{ plan.pesh_year_zh or plan.pesh_year }})</span></p>
    <p>
        <span class="inline-elements"><strong>æ—¥æœŸ:</strong> {{ plan.date_zh or plan.date }}</span>
        <span class="inline-elements"><strong>ä¸Šèª²æ™‚é–“:</strong> {{ plan.class_duration_zh or plan.class_duration }}åˆ†é˜ ({{ plan.start_time_zh or plan.start_time }} è‡³ {{ plan.end_time_zh or plan.end_time }})</span>
    </p>
    <p><strong>å­¸æ ¡åç¨±:</strong> {{ plan.school_name_zh }}</p>
    <p>
        <span class="inline-elements"><strong>ç­ç´š:</strong> {{ plan.year_zh or plan.year }}</span>
        <span class="inline-elements"><strong>ç­åˆ¥:</strong> {{ plan.class_id_zh }}</span>
        <span class="inline-elements"><strong>é¡åˆ¥:</strong> {{ plan.class_level_zh }}</span>
        <span class="inline-elements"><strong>å­¸ç”Ÿäººæ•¸:</strong> {{ plan.class_size_zh or plan.class_size }}</span>
        <span class="inline-elements"><strong>ç”·ç”Ÿ:</strong> {{ plan.boys_zh or plan.boys }}</span>
        <span class="inline-elements"><strong>å¥³ç”Ÿ:</strong> {{ plan.girls_zh or plan.girls }}</span>
    </p>
    <p><strong>å–®å…ƒä¸»é¡Œ: </strong>{{ plan.topic_zh }} <span class="inline-elements">(ç¬¬ {{ plan.day_of_unit_zh or plan.day_of_unit }} èª²æ™‚ / {{ plan.unit_duration_zh or plan.unit_duration }} å¤©)</span></p>
    <p><strong>æœ¬æ•™ç¯€çš„æ•™å­¸ä¸»é¡Œ:</strong> {{ plan.lesson_theme_zh }}</p>
    {% set beg_zh = (plan.beginner_percent_zh or 0) | int %}
    {% set inter_zh = (plan.intermediate_percent_zh or 0) | int %}
    {% set adv_zh = (plan.advance_percent_zh or 0) | int %}
    {% set total_zh = beg_zh + inter_zh + adv_zh %}
    <p><strong>å­¸ç”Ÿæ•´é«”èƒ½åŠ›æ°´å¹³:</strong> {{ plan.ability_level_zh or plan.ability_level }}% ç†Ÿç·´åº¦</p>
    <ul class="list-unstyled ms-3 mb-2">
        <li>åˆå­¸è€…: {{ beg_zh }}%</li>
        <li>ä¸­ç´š: {{ inter_zh }}%</li>
        <li>é«˜ç´š: {{ adv_zh }}%</li>
    </ul>
    <div class="ability-bar-wrapper" style="position: relative;">
        <div class="ability-bar" aria-hidden="true">
            {% if total_zh > 0 %}
                <div class="ability-divider" style="left: {{ beg_zh }}%;"></div>
                <div class="ability-divider" style="left: {{ beg_zh + inter_zh }}%;"></div>
            {% endif %}
        </div>
        {% if total_zh > 0 %}
            {% set beg_pos_zh = (beg_zh / 2) %}
            {% set inter_pos_zh = beg_zh + (inter_zh / 2) %}
            {% set adv_pos_zh = beg_zh + inter_zh + (adv_zh / 2) %}
            <div class="ability-labels-absolute small text-muted">
                <span style="left: {{ beg_pos_zh }}%;">åˆå­¸è€… {{ beg_zh }}%</span>
                <span style="left: {{ inter_pos_zh }}%;">ä¸­ç´š {{ inter_zh }}%</span>
                <span style="left: {{ adv_pos_zh }}%;">é«˜ç´š {{ adv_zh }}%</span>
            </div>
        {% endif %}
    </div>

    <!-- Chinese Objectives Table -->
    <h4 class="section-title">1) æ•™å­¸ç›®æ¨™ï¼šå­¸ç”Ÿå°‡èƒ½</h4>
    <table class="lesson-table">
        <tbody>
            <tr>
                <td>
                    <p><strong>i) æŠ€èƒ½è¡¨ç¾ç›®æ¨™</strong></p>
                    <p>{{ plan.psychomotor_objs_zh }}</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p><strong>ii) èªçŸ¥è¡¨ç¾ç›®æ¨™</strong></p>
                    <p>{{ plan.cognitive_objs_zh }}</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p><strong>iii) æƒ…æ„è¡¨ç¾ç›®æ¨™</strong></p>
                    <p>{{ plan.affective_objs_zh }}</p>
                </td>
            </tr>
        </tbody>
    </table>

    <p><strong>æ•™å­¸å ´åœ°/è¨­æ–½:</strong> {{ plan.venue_zh }}</p>
    <p><strong>å™¨æ:</strong> {{ plan.equipment_zh }}</p>
    <p><strong>å®‰å…¨è€ƒæ…®:</strong> {{ plan.safety_concerns_zh }}</p>
</div>

<div class="page-break"></div>

<!-- CHINESE LESSON PLANNING TABLE -->
<div class="lesson-section chinese-section">
    <h4 class="section-title">2) æ•™æ¡ˆè¦åŠƒï¼š</h4>
    
    <table class="lesson-table">
        <thead>
            <tr>
                <th style="width: 8%;">æ™‚é–“ï¼ˆåˆ†é˜ï¼‰</th>
                <th style="width: 25%;">æ•™å­¸å…§å®¹/æ´»å‹•</th>
                <th style="width: 23%;">æ•™å­¸è¦é»/ç›®æ¨™</th>
                <th style="width: 25%;">èª²å ‚çµ„ç¹”/ç®¡ç†/æ•™å¸«ä½ç½®</th>
                <th style="width: 19%;">æ‰€éœ€å™¨æ/ç”¨å…·</th>
            </tr>
        </thead>
        <tbody>
            <!-- å¼•å…¥æ´»å‹• -->
            {% if plan.intro_activities_zh %}
                {% for activity in plan.intro_activities_zh %}
                <tr>
                    <td style="text-align: center;"><strong>{{ activity.time }}</strong></td>
                    <td>{% if loop.first %}<strong>å¼•å…¥æ´»å‹•</strong><br>{% endif %}{{ activity.content or '' }}</td>
                    <td style="text-align: center;">{{ activity.cues }}</td>
                    <td style="text-align: center;">
                        {% if activity.diagram %}
                            <img src="{{ activity.diagram }}" style="max-width:100%; max-height:100px;" alt="åœ–è¡¨">
                        {% else %}
                            <em>(æ²’æœ‰ä¸Šå‚³åœ–è¡¨)</em>
                        {% endif %}
                    </td>
                    <td style="text-align: center;">{{ activity.equipment }}</td>
                </tr>
                {% endfor %}
            {% else %}
            <tr>
                <td style="text-align: center;"><strong>{{ plan.intro_time }}</strong></td>
                <td><strong>å¼•å…¥æ´»å‹•</strong></td>
                <td style="text-align: center;">{{ plan.intro_cues_zh }}</td>
                <td style="text-align: center;">
                    {% if plan.intro_diagram %}
                        <img src="{{ plan.intro_diagram }}" style="max-width:100%; max-height:100px;" alt="å¼•å…¥æ´»å‹•åœ–è¡¨">
                    {% else %}
                        <em>(æ²’æœ‰ä¸Šå‚³åœ–è¡¨)</em>
                    {% endif %}
                </td>
                <td style="text-align: center;">{{ plan.intro_equipment_zh }}</td>
            </tr>
            {% endif %}
            
            <!-- æŠ€èƒ½ç™¼å±• -->
            {% if plan.sd_activities_zh %}
                {% for activity in plan.sd_activities_zh %}
                <tr>
                    <td style="text-align: center;"><strong>{{ activity.time }}</strong></td>
                    <td>{% if loop.first %}<strong>æŠ€èƒ½ç™¼å±•</strong><br>{% endif %}{{ activity.content or '' }}</td>
                    <td style="text-align: center;">{{ activity.cues }}</td>
                    <td style="text-align: center;">
                        {% if activity.diagram %}
                            <img src="{{ activity.diagram }}" style="max-width:100%; max-height:100px;" alt="åœ–è¡¨">
                        {% else %}
                            <em>(æ²’æœ‰ä¸Šå‚³åœ–è¡¨)</em>
                        {% endif %}
                    </td>
                    <td style="text-align: center;">{{ activity.equipment }}</td>
                </tr>
                {% endfor %}
            {% else %}
            <tr>
                <td style="text-align: center;"><strong>{{ plan.sd_time }}</strong></td>
                <td><strong>æŠ€èƒ½ç™¼å±•</strong></td>
                <td style="text-align: center;">{{ plan.sd_cues_zh }}</td>
                <td style="text-align: center;">
                    {% if plan.sd_diagram %}
                        <img src="{{ plan.sd_diagram }}" style="max-width:100%; max-height:100px;" alt="æŠ€èƒ½ç™¼å±•åœ–è¡¨">
                    {% else %}
                        <em>(æ²’æœ‰ä¸Šå‚³åœ–è¡¨)</em>
                    {% endif %}
                </td>
                <td style="text-align: center;">{{ plan.sd_equipment_zh }}</td>
            </tr>
            {% endif %}
            
            <!-- éå›º/æ‡‰ç”¨æ´»å‹• -->
            {% if plan.appli_activities_zh %}
                {% for activity in plan.appli_activities_zh %}
                <tr>
                    <td style="text-align: center;"><strong>{{ activity.time }}</strong></td>
                    <td>{% if loop.first %}<strong>éå›º/æ‡‰ç”¨æ´»å‹•</strong><br>{% endif %}{{ activity.content or '' }}</td>
                    <td style="text-align: center;">{{ activity.cues }}</td>
                    <td style="text-align: center;">
                        {% if activity.diagram %}
                            <img src="{{ activity.diagram }}" style="max-width:100%; max-height:100px;" alt="åœ–è¡¨">
                        {% else %}
                            <em>(æ²’æœ‰ä¸Šå‚³åœ–è¡¨)</em>
                        {% endif %}
                    </td>
                    <td style="text-align: center;">{{ activity.equipment }}</td>
                </tr>
                {% endfor %}
            {% else %}
            <tr>
                <td style="text-align: center;"><strong>{{ plan.appli_time }}</strong></td>
                <td><strong>éå›º/æ‡‰ç”¨æ´»å‹•</strong></td>
                <td style="text-align: center;">{{ plan.appli_cues_zh }}</td>
                <td style="text-align: center;">
                    {% if plan.appli_diagram %}
                        <img src="{{ plan.appli_diagram }}" style="max-width:100%; max-height:100px;" alt="æ‡‰ç”¨æ´»å‹•åœ–è¡¨">
                    {% else %}
                        <em>(æ²’æœ‰ä¸Šå‚³åœ–è¡¨)</em>
                    {% endif %}
                </td>
                <td style="text-align: center;">{{ plan.appli_equipment_zh }}</td>
            </tr>
            {% endif %}
            
            <!-- æ•´ç†æ´»å‹• -->
            {% if plan.ca_activities_zh %}
                {% for activity in plan.ca_activities_zh %}
                <tr>
                    <td style="text-align: center;"><strong>{{ activity.time }}</strong></td>
                    <td>{% if loop.first %}<strong>æ•´ç†æ´»å‹•</strong><br>{% endif %}{{ activity.content or '' }}</td>
                    <td style="text-align: center;">{{ activity.cues }}</td>
                    <td style="text-align: center;">
                        {% if activity.diagram %}
                            <img src="{{ activity.diagram }}" style="max-width:100%; max-height:100px;" alt="åœ–è¡¨">
                        {% else %}
                            <em>(æ²’æœ‰ä¸Šå‚³åœ–è¡¨)</em>
                        {% endif %}
                    </td>
                    <td style="text-align: center;">{{ activity.equipment }}</td>
                </tr>
                {% endfor %}
            {% else %}
            <tr>
                <td style="text-align: center;"><strong>{{ plan.ca_time }}</strong></td>
                <td><strong>æ•´ç†æ´»å‹•</strong></td>
                <td style="text-align: center;">{{ plan.ca_cues_zh }}</td>
                <td style="text-align: center;">
                    {% if plan.ca_diagram %}
                        <img src="{{ plan.ca_diagram }}" style="max-width:100%; max-height:100px;" alt="æ•´ç†æ´»å‹•åœ–è¡¨">
                    {% else %}
                        <em>(æ²’æœ‰ä¸Šå‚³åœ–è¡¨)</em>
                    {% endif %}
                </td>
                <td style="text-align: center;">{{ plan.ca_equipment_zh }}</td>
            </tr>
            {% endif %}
        </tbody>
    </table>

    <!-- Chinese Follow-up and Reflection -->
    <h4 class="section-title">3) èª²å ‚å®Œçµå¾Œï¼š</h4>
    <h5 class="fw-bold fs-6">è·Ÿé€²äº‹é …:</h5>
    <p>{{ plan.followup_actions_zh }}</p>

    <h5 class="fw-bold fs-6 mt-3">è‡ªæˆ‘åæ€:</h5>
    <p>{{ plan.self_reflection_zh }}</p>
</div>

<p class="text-center fw-semibold mt-4">CUHK Faculty of Education</p>

{% endif %}

<!-- Action Buttons -->
<div class="text-center mt-4 no-print">
    <a href="{{ url_for('create_lesson_form') }}" class="btn btn-primary me-2">Back to Edit</a>
    <a href="{{ url_for('create_lesson_form') }}" class="btn btn-outline-primary me-2">Create Another Lesson Plan</a>
    <a href="{{ url_for('create_unit_form') }}" class="btn btn-outline-primary me-2">Create Unit Plan</a>
    <button onclick="window.print()" class="btn btn-outline-primary me-2">Print Plan</button>
</div>

<button onclick="window.print()" class="btn btn-primary print-btn no-print">
    ğŸ“„ Print
</button>
{% endblock %}
